{{- $path := . -}}
{{- $asset := resources.Get $path -}}
{{- if not $asset -}}
    {{- errorf "Asset not found: %s" $path -}}
{{- end -}}

{{- /* Use scratch for mutable state */ -}}
{{- $scratch := newScratch -}}
{{- $scratch.Set "content" $asset.Content -}}

{{- /* Regex to match @import "path" or @import 'path' statements */ -}}
{{- $importRegex := `@import\s*["']([^"']+)["']\s*;?` -}}

{{- /* Find all @import matches */ -}}
{{- $matches := findRE $importRegex ($scratch.Get "content") -}}

{{- /* Process each @import statement */ -}}
{{- range $match := $matches -}}
    {{- /* Extract the path from the @import statement */ -}}
    {{- $importPath := replaceRE $importRegex "$1" $match -}}

    {{- /* Build the full path: css/ + importPath + .css */ -}}
    {{- $fullPath := printf "css/%s.css" $importPath -}}

    {{- /* Check if the path exists */ -}}
    {{- if not (resources.Get $fullPath) -}}
        {{- errorf "Imported CSS file not found: %s" $fullPath -}}
    {{- end -}}

    {{- /* Recursively get the content of the imported file */ -}}
    {{- $importedContent := htmlUnescape (partial "css-content.html" $fullPath) -}}

    {{- /* Replace the @import statement with the imported content */ -}}
    {{- $scratch.Set "content" (replace ($scratch.Get "content") $match $importedContent) -}}
{{- end -}}

{{- $scratch.Get "content" -}}
